# folkcritic
Building on top of https://github.com/IraKorshunova/folk-rnn/ and introducing a 'critic' that actively learns from feedback provided by a human in the loop  
## Setting up the webserver
### if using conda and Linux
$ conda create -n folkcritic --file requirements.txt
### if using an ARM based Mac
$ conda env create -n folkcritic -f arm_requirements.yaml
### Activating the environment
$ conda activate folkcritic
### update database
$ python manage.py makemigrations
$ python manage.py migrate
### create a user
$ python manage.py createsuperuser
### Running the server
$ python manage.py runserver

## Using the webserver and training the critic
1. Navigate to 127.0.0.1:8000 and log in using the super user credentials to start training the critic 
(alternatively, navigate to the admin gui, 127.0.0.1:8000/admin, to create additional users)
<img width="1440" alt="Screenshot 2022-10-22 at 14 07 27" src="https://user-images.githubusercontent.com/25374765/197338209-0ef9b9cd-e326-4972-a25d-e4c955473752.png">

### Setting up a session
Folkcritic can handle multiple sessions per user and all sessions are continously stored which means it is possible to go back and continue with a previous session at any time. 
<img width="1440" alt="Screenshot 2022-10-22 at 14 13 03" src="https://user-images.githubusercontent.com/25374765/197338484-fcb35dbe-a7d7-463b-9cae-1c0c8f5e52d4.png">
### Training the critic
The main window shows the score and ABC notation of a song that has been generated by Folk RNN. It is possible to listen to the song by pressing <kbd class="keyboard-key nowrap">Space bar</kbd>, to like or dislike the song by pressing either the buttons or <kbd class="keyboard-key nowrap">x</kbd> and <kbd class="keyboard-key nowrap">c</kbd> respectively. The bottom displays information about the critic, such as how many songs it has been trained on and the critic score of the currently displayed song. 
<img width="1440" alt="Screenshot 2022-10-22 at 14 23 16" src="https://user-images.githubusercontent.com/25374765/197339517-f5064f3c-6374-44dd-8306-8d66cc17da8b.png">

A higher critic score indicates a more likeable song. The system generates songs in the background until there is a song generated with a critic score above 0.5 or a total of 5 songs have been generated in which case the best scoring one is displayed.
1. Liking or disliking a song retrains the critic and generates a new song that passes the criteria above 
2. It is possible to change the training parameters of the critic at any time and retrain it with all the songs that have been liked/disliked during the session
3. It is also possible to reset the critic but it is worth noting that every time a new song is liked or disliked the critic is retrained on all the songs in the current session
4. Is is always possible to change the session or create a new one
5. After enough training is done, the critic can be evaluated to see if it has managed to learn the preferences of the user

### Evaluating the critic
It is possible to evaluate the critic on any number of songs. Half of the songs are generated using the trained critic while the other half are generated using an untrained critic. The songs are then displayed to the user in random order and liked/disliked similar to the training but without displaying information on the critic score to the user. 
<img width="1440" alt="Screenshot 2022-10-22 at 14 51 16" src="https://user-images.githubusercontent.com/25374765/197340326-d240f1f7-e53b-4b76-99ec-b507f2bf1c50.png">

After the user has liked/disliked the songs the result of the evaluation is displayed indicating whether the trained critic outperforms the untrained one.
<img width="1440" alt="Screenshot 2022-10-22 at 14 58 33" src="https://user-images.githubusercontent.com/25374765/197340346-26f57187-02b3-4133-aea2-81dcbbcee687.png">

## Further improvements
It should be noted that the setup could be improved significantly by increasing the complexity of the TF model used for the critic. Currently only one layer is used which means the model just weighs the input and is not capable of really learning anything significant. 
Another obvious limitation is the number of songs generated before displaying a song to the user. If the critic is trained on a larger number of songs it would be beneficial to increase this number from 5 that is currently used. As the critic learns the average score of the songs from the generator tends to decrease which means fewer songs actually pass through the critics scrutiny. 
